<div class="w-full h-full max-w-full flex flex-col items-stretch justify-items-start">
  <div class="flex flex-row items-center justify-between p-3">
    <h2><strong>{{ tableName() }}</strong></h2>
    <button mat-raised-button color="primary" (click)="openExportDialog()">
      <mat-icon>download</mat-icon> Export to CSV
    </button>
  </div>

  <mat-divider class="w-full"></mat-divider>

  <div class="overflow-x-auto max-w-full w-full grow">
    <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z8">
      
      <!-- Dynamic Column Definitions -->
      <ng-container *ngFor="let column of columnsToDisplay()" [matColumnDef]="column">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          {{ columnNameMapping[column] || column | snakeCaseToString }}
        </th>
        <td mat-cell *matCellDef="let element">{{ element[column] }}</td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="columnsToDisplay()"></tr>
      <tr mat-row *matRowDef="let row; columns: columnsToDisplay();" (click)="showDetails(row)"></tr>
    </table>
  </div>

  <!-- Pagination -->
  <mat-paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons></mat-paginator>
</div>

<!-- Details Component -->
@if (dynamicDetails()) {
  <app-dynamic-details />
}
